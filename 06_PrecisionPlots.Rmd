---
title: "Score summary plots"
output: html_document
date: "2025-02-18"
---

# Set up
```{r}
rm(list=ls())
library(tidyverse)
source("~/Documents/Projects/tutivia_AV_paper_2025/AV_Plots.R")

df<-read.csv("/Users/alinaklineschoder/Desktop/Data_AnalyticalValidation_Organized/CVs.csv")%>%
  filter(grepl("Rep",Type))

AllScores<-read.csv("/Users/alinaklineschoder/Desktop/Data_AnalyticalValidation_Organized/FinalScores.csv")%>%
  dplyr::select(-c("X"))
Vec<-AllScores$Score
names(Vec)<-AllScores$Sample
SampleInfo<-read.csv("/Users/alinaklineschoder/Desktop/AVSampleKey.csv")
AllScores$Sample.Name=AllScores$Sample

Full<-left_join(AllScores,SampleInfo)
```

# CV of genes
```{r}
boxwisk<-ggplot(df%>%filter(Type=="Repeatability"), aes(x=value, y=Gene)) +
  geom_boxplot(outlier.shape = NA,size=0.1) +
  geom_jitter(aes(color=Control),size=0.5)+
  facet_grid(.~Control, scales="free_y") +
  theme_minimal() +
  scale_color_manual(values=col)+
  CV_Theme+
  xlab("CV (%)") +
  geom_vline(xintercept = 15, linetype = "dashed", size = 0.1) +
    geom_text(data = df %>% filter(value > 15 & value < 20), 
              aes(label = round(value, 1),color=Control), 
              hjust = -0.2, 
              size = 3, 
              show.legend = FALSE)+
    geom_text(data = df %>% filter(value > 20), 
              aes(label = round(value, 1),color=Control), 
              hjust = 1.3, 
              size = 3, 
              show.legend = FALSE)+Paired_Theme +
  theme(legend.position = "none",strip.text.x = element_text(size=11,face="bold"))
```

# Scores
```{r}
FT<-Full %>% 
  filter(Category == "Repeatability")%>%
  separate(Parameter,into=c("Parameter","rem"),sep = "_")

ggp_FT_Score<-ScorePlot(FT,error=T)
```


```{r}
# Adjust the plots with consistent sizing and titles
adjusted_plots <- list(
  boxwisk+theme(legend.position = "none"),
  ggp_FT_Score+theme(legend.position = "none")+theme(axis.title.y=element_text(vjust=-20)))

# Extract the legends

Full <- (
  adjusted_plots[[1]] / 
  adjusted_plots[[2]]
  ) +
  plot_layout(
    guides = "collect"
  ) & 
  theme(plot.margin = margin(0.25, 0.25, 0.25, 0.25, "cm"))

ggsave(plot=Full,filename = "/Users/alinaklineschoder/Desktop/Data_AnalyticalValidation_Organized/Figures/Precision.png",bg="white",width = 8,height = 8)
```


